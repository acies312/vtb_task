# –æ—Ç—á–µ—Ç

**–ó–∞–¥–∞–Ω–∏–µ 1.1**

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å VirtualBox (–∏–ª–∏ VMware workstation player), —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é vm –Ω–∞ –±–∞–∑–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞ Centos (Centos —ç—Ç–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è open source –≤–µ—Ç–∫–∞ rhel)
    
    ![Untitled](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/Untitled.png)
    
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–π vm –ø–æ ssh —á–µ—Ä–µ–∑ –ª—é–±–æ–π –∫–ª–∏–µ–Ω—Ç.
    
    ![Untitled](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/Untitled%201.png)
    
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω–æ–π vm
    
    ![Untitled](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/Untitled%202.png)
    
- –í –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É task; —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ key-values —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ Python. –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ —Ñ–∞–π–ª–µ storage.data(–≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É tempfile, –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö). –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ storage.py. –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —É—Ç–∏–ª–∏—Ç—ã:
    
    –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    
    `$¬†storage.py¬†--key¬†key_name¬†--val¬†value`
    
    –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    
    `$¬†storage.py¬†--key¬†key_name`
    
    –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–º—É –∫–ª—é—á—É –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è, –∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º. –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ - –ø–æ –æ–¥–Ω–æ–º—É –∫–ª—é—á—É –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π. –ü—Ä–∏ –≤—ã–≤–æ–¥–µ –Ω–∞ –ø–µ—á–∞—Ç—å, –∑–Ω–∞—á–µ–Ω–∏—è –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–ü—Ä–∏–º–µ—Ä –≤–≤–æ–¥–∞ "test_value,test_value2,test_value3" ). –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ –Ω–∞ –ø–µ—á–∞—Ç—å –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é. –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –∫–ª—é—á—É –Ω–µ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ, –≤—ã–≤–µ–¥–∏—Ç–µ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –∏–ª–∏ None. –°–¥–µ–ª–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –µ—Å–ª–∏ –æ–Ω–∏ –±—É–¥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏. –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –û–°.
    
    ![Untitled](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/Untitled%203.png)
    
    ```python
    import argparse, os, jso**n, tempfile
     
    # –¥–æ–±–∞–≤–ª—è–µ–º –∞—Ä–≥—É–º–µ–Ω**—Ç—ã –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏
    parser = argparse.ArgumentParser()
    parser.add_argument("--key", type=str, required=True)
    parser.add_argument("--val", type=str)
    args = parser.parse_args()
     
    # –ø–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è key-value –∑–Ω–∞—á–µ–Ω–∏–π
    storage_path = os.path.join(tempfile.gettempdir(), 'storage.data')
    
    # –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ñ–∞–π–ª
    if os.path.isfile(storage_path):
        if args.val: # –µ—Å–ª–∏ –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω val –∞—Ä–≥—É–º–µ–Ω—Ç
            with open(str(storage_path), "r") as f:
                m = json.load(f)
                if args.key in m: #–µ—Å–ª–∏ –∫–ª—é—á —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω –≤ —Ñ–∞–π–ª–µ –¥–æ–±–∞–≤–ª–µ–º –∫ –Ω–µ–º—É –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏ val
                    m[args.key] = m[args.key] + [args.val]
                else:
                    m.update({args.key: [args.val]})
            with open(str(storage_path), "w") as f:
                json.dump(m, f)
        # –Ω–∞ —á—Ç–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É
        else:
            with open(str(storage_path), "r") as f:
                m = json.load(f)
                if args.key in m.keys():
                    if len(m[args.key]) > 1:
                        print(', '.join(m.get(args.key)))
                    else:
                        print(*m.get(args.key))
                else:
                    raise Exception('no such key in dict')
    # –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞
    else:
        d = {}
        with open(str(storage_path), "w") as f:
            if args.val:
                d = {args.key: [args.val]}
            json.dump(d, f)
    ```
    

**–ó–∞–¥–∞–Ω–∏–µ 1.2 (—É—Å–ª–æ–∂–Ω–µ–Ω–Ω–æ–µ)**

****–ù–∞–ø–∏—Å–∞—Ç—å —Å–µ—Ä–≤–∏—Å API –Ω–∞ Python –∫ key-values —Ö—Ä–∞–Ω–∏–ª–∏—â—É –∏–∑ –∑–∞–¥–∞–Ω–∏—è 1. –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ flask –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å flaskRESTful. –•—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ —Ç–∞–∫ –∂–µ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –≤ —Ñ–∞–π–ª–µ storage.data(–≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É tempfile). –°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã POST –∏ GET. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≤—ã–≤–æ–¥—É –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ –∑–∞–¥–∞–Ω–∏—è 1. –ù–∏–∂–µ –≤ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö –µ—Å—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∏—Ö –≤—ã–≤–æ–¥–∞. –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–µ—Ä–≤–∏—Å–∞ ‚Äò/‚Äô —Å–¥–µ–ª–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Å–µ—Ä–≤–∏—Å–∞ API.

<aside>
üí¨ –î–∞–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ª–∏—à—å —á–∞—Å—Ç–∏—á–Ω–æ. API –Ω–∞–ø–∏—Å–∞–Ω, –Ω–æ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, —Å–∞–º —Å–µ—Ä–≤–∏—Å —Ç–æ–∂–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç —É–¥–∞—á–Ω–æ.
–ü—Ä–∏–ª–æ–∂–∏–ª —á—Ç–æ —É—Å–ø–µ–ª —Å–¥–µ–ª–∞—Ç—å.

</aside>

**–ó–∞–¥–∞–Ω–∏–µ 2.1**

- –°–æ–∑–¥–∞—Ç—å 2 WEB —Å–µ—Ä–≤–µ—Ä–∞ —Å –≤—ã–≤–æ–¥–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã ¬´Hello, World! \n Server 1¬ª (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ Server 2). –°–¥–µ–ª–∞—Ç—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏ (HA + keepalived), —á—Ç–æ–±—ã –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º—ã –ø–æ–ø–∞–¥–∞–ª–∏ –Ω–∞ –ª—é–±–æ–π –∏–∑ WEB —Å–µ—Ä–≤–µ—Ä–æ–≤(–î–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å 2 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞, –≤ —Å—É–º–º–µ 4).
    
    –ë—É–¥–µ—Ç –ø–ª—é—Å–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker.
    
    ![—Ä–∞–±–æ—Ç–∞ HAproxy](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/Untitled%204.png)
    
    —Ä–∞–±–æ—Ç–∞ HAproxy
    
    <aside>
    üí¨ *–ó–¥–µ—Å—å –≤ –ª–µ–≤–æ–º –æ–∫–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏–¥–Ω–æ, —á—Ç–æ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–≤–æ–≥–æ loadbalancer‚Äô–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–æ –≤—Ç–æ—Ä–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞ loadbalancer2*
    
    </aside>
    
    ![–†–∞–±–æ—Ç–∞ Keepalived](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/Untitled%205.png)
    
    –†–∞–±–æ—Ç–∞ Keepalived
    
    <aside>
    üí¨ –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è –≤ —Ä–∞–±–æ—Ç—É –ø–µ—Ä–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –æ–Ω –ø–æ–ª—É—á–∏–ª –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π ip –∏ –ø—Ä–æ–¥–æ–ª–∂–∏–ª —Ä–∞–±–æ—Ç—É –∫–∞–∫ MASTER —É–∑–µ–ª keepalived. 
    –û–¥–Ω–∞–∫–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–∏—Å keepalived. –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—è—Å–Ω–∏—Ç—å –ø–æ—á–µ–º—É —Å–µ—Ä–≤–∏—Å –Ω–µ –ø–æ–ª—É—á–∞–ª–æ—Å—å –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∏ –∏–∑ Dockerfile, –Ω–∏ –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –≤ ENTRYPOINT.
    –¢–∞–∫ –∂–µ —Ä–∞–±–æ—Ç—É —Å–∫—Ä–∏–ø—Ç–∞ –≤ keepalived, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã haproxy, –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑—É—è docker, —Ç.–∫. haproxy –∏–º–µ–ª PPID=1, —á—Ç–æ –º–µ—à–∞–ª–æ –≤—ã–∫–ª—é—á–∏—Ç—å –µ–≥–æ –∏ –ø—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, —á—Ç–æ haproxy –±–æ–ª—å—à–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω (—Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–ª pgrep haproxy)
    
    </aside>
    
    ![–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã loadbalancer1](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/Untitled%206.png)
    
    –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã loadbalancer1
    
    **–ó–∞–¥–∞–Ω–∏–µ 2.2(—É—Å–ª–æ–∂–Ω–µ–Ω–Ω–æ–µ)**
    
    –ù–∞–ø–∏—Å–∞—Ç—å —Ä–æ–ª—å –Ω–∞ Ansible –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é —Å—Ç–µ–Ω–¥–∞ –∏–∑ –ó–∞–¥–∞–Ω–∏–µ 2.1. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω —Ñ–∞–π–ª –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –ø–æ –ø—Ä–∏–º–µ—Ä—É:
    
    ```
    [loadbalancers]
    ha1 ansible_host=10.10.1.1
    ha2 ansible_host=10.10.1.2
    [webservers]
    web1 ansible_host=10.10.1.1
    web2 ansible_host=10.10.1.2
    ```
    
    –ú–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å 1 –±–æ–ª—å—à—É—é —Ä–æ–ª—å, –ª–∏–±–æ 3 —Ä–æ–ª–∏ –∏ –ø–æ—Ç–æ–º –≤—ã–∑–≤–∞—Ç—å –∏—Ö –ø–æ–æ—á—ë—Ä–¥–Ω–æ.
    –†–æ–ª—å Nginx ‚Äì —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç Nginx –Ω–∞ –≥—Ä—É–ø–ø–µ —Ö–æ—Å—Ç–æ–≤ [webservers].
    –†–æ–ª—å HA Proxy ‚Äì —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç HA Proxy –Ω–∞ –≥—Ä—É–ø–ø–µ —Ö–æ—Å—Ç–æ–≤ [loadbalancers].
    –†–æ–ª—å Keepalived ‚Äì —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç Keepalived –Ω–∞ –≥—Ä—É–ø–ø–µ —Ö–æ—Å—Ç–æ–≤ [loadbalancers].
    –ö–æ–Ω—Ñ–∏–≥–∏ nginx, HA proxy, keepalived –æ—Ñ–æ—Ä–º–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è —à–∞–±–ª–æ–Ω—ã Jinja2(—è–∑—ã–∫ —à–∞–±–ª–æ–Ω–æ–≤).
    –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤ Jinja2:
    –í –∫–∞—Ç–∞–ª–æ–≥–µ /roles/nginx/templates —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥ nginx.conf, –¥–∞–ª–µ–µ –≤ —Ä–æ–ª–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
    
    ```yaml
    name: Add nginx config
    template:
    	src=template/nginx.conf
    	dest=/etc/nginx/nginx.conf
    ```
    
    –ò—Ç–æ–≥–æ–≤—ã–π playbook –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π —Ç—Ä–∏ —Ä–æ–ª–∏ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º.
    
    ```yaml
    hosts: webservers
    become: yes
    roles:
    nginx
    hosts: loadbalancers
    become: yes
    roles:
    ha-proxy
    hosts: loadbalancers
    become: yes
    roles:
    keepalived
    ```
    
    –ó–∞–ø—É—Å–∫ –∏—Ç–æ–≥–æ–≤–æ–≥–æ playbook –ø—Ä–∏–º–µ—Ä–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫
    Ansible-playbook ‚Äìi <inventory_file> nginx_haproxy_ha.yml
    
    <aside>
    üí¨ –∑–¥–µ—Å—å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ –¥–ª—è keepalived –≤ –∏–Ω–≤–µ—Ç–æ—Ä–∏ —Ñ–∞–π–ª–µ —É —Ö–æ—Å—Ç–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.
    
    </aside>
    
    ![–ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã ansible](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/Untitled%207.png)
    
    –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã ansible
    
    ![–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π playbook](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25B0_%25D0%25BF%25D0%25BB%25D0%25B5%25D0%25B9%25D0%25B1%25D1%2583%25D0%25BA%25D0%25B0.png)
    
    –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π playbook
    
    <aside>
    üí¨ –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ roundrobin –Ω–∞ haproxy —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π ip, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –¥–ª—è keepalived
    
    </aside>
    
    ![—Ä–∞–±–æ—Ç–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ HAproxy](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25B0_haproxy_%25D0%25BD%25D0%25B0_%25D0%25B2%25D0%25B8%25D1%2580%25D1%2582%25D1%2583%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25BC_ip.png)
    
    —Ä–∞–±–æ—Ç–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ HAproxy
    
    <aside>
    üí¨ —Å–ª–µ–≤–∞ BACKUP —Å–µ—Ä–≤–µ—Ä, –∞ —Å–ø—Ä–∞–≤–∞ MASTER —Å–µ—Ä–≤–µ—Ä. –Ω–∞ –¥–∞–Ω–Ω–æ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —É–∑–ª–æ–≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ
    
    </aside>
    
    ![–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ keepalived](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25B0_keepalived_%25D1%2581%25D1%2582%25D0%25B0%25D1%2580%25D1%2582%25D0%25BE%25D0%25B2%25D0%25BE_%25D1%2581%25D0%25BE%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5.png)
    
    –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ keepalived
    
    <aside>
    üí¨ –ü–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ HAproxy –Ω–∞ MASTER —Å–µ—Ä–≤–µ—Ä–µ —Ä–æ–ª—å MASTER –≤–∑—è–ª –Ω–∞ —Å–µ–±—è –≤—Ç–æ—Ä–æ–π —É–∑–µ–ª - —Å–∫—Ä–∏–ø—Ç –æ—Ç—Ä–∞–±–æ—Ç–∞–ª, keepalived –æ—Ç—Ä–∞–±–æ—Ç–∞–ª.
    
    </aside>
    
    ![–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ HAproxy –Ω–∞ MASTER —É–∑–ª–µ](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/keepalive_%25D0%25BF%25D0%25BE%25D1%2581%25D0%25BB%25D0%25B5_%25D0%25BE%25D1%2582%25D1%2581%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B8_%25D1%2585%25D0%25B0%25D0%25BF%25D1%2580%25D0%25BE%25D0%25BA%25D1%2581%25D0%25B8.png)
    
    –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ HAproxy –Ω–∞ MASTER —É–∑–ª–µ
    
    <aside>
    üí¨ –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã HAproxy –Ω–∞ –ø–µ—Ä–≤–æ–º —É–∑–ª–µ —Ä–æ–ª—å MASTER –≤–µ—Ä–Ω—É–ª–∞—Å—å –µ–º—É, –∞ –≤—Ç–æ—Ä–æ–π —É–∑–µ–ª –ø–µ—Ä–µ—à–µ–ª –≤ BACKUP —Ä–æ–ª—å.
    
    </aside>
    
    ![–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ HAproxy –Ω–∞ –ø–µ—Ä–≤–æ–º —É–∑–ª–µ](%D0%BE%D1%82%D1%87%D0%B5%D1%82%20ebcf9f0275e343adabb1d3cd4fb8a1a1/%25D0%25B2%25D0%25B5%25D1%2580%25D0%25BD%25D1%2583%25D0%25BB_%25D1%2585%25D0%25B0%25D0%25BF%25D1%2580%25D0%25BE%25D0%25BA%25D1%2581%25D0%25B8.png)
    
    –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ HAproxy –Ω–∞ –ø–µ—Ä–≤–æ–º —É–∑–ª–µ
